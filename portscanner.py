from scapy.all import *
from scapy.layers.inet import TCP, IP

logging.getLogger("scapy.runtime").setLevel(logging.ERROR)

if len(sys.argv) != 4:
 print("Usage: %s target startport endport" % (sys.argv[0]))
 sys.exit(0)


target = str(sys.argv[1])
startport = int(sys.argv[2])
endport = int(sys.argv[3])

print("Scanning " + target + " for open TCP ports in range (" + str(startport) + " - "+ str(endport) + ").")

if startport == endport:
 endport += 1
try:
 for port in range(startport, endport):
  packet = IP(dst=target) / TCP(dport=port, flags="S")
  response = sr1(packet, timeout=0.5, verbose=0)
  if response.haslayer(TCP) and response.getlayer(TCP).flags == 0x12: # SYN-ACK.
   print("Port " + str(port) + " is open!")
   sr(IP(dst=target) / TCP(dport=response.sport, flags="R"), timeout=0.5, verbose=0)

except AttributeError:
 pass
print("Scan is complete!")
